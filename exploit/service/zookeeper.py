# coding=utf-8
# @Author   : zpchcbd HG team
# @Time     : 2021-08-27 18:34
from core.data import gLogger
import asyncio


async def check_unauth(addr):
    reader, writer = await asyncio.open_connection(addr.split(':')[0], int(addr.split(':')[1]))
    writer.write(b'envi')
    await writer.drain()
    result = await reader.read(1024)
    writer.close()
    if b"zookeeper.version" in result:
        gLogger.myscan_info('target maybe zookeeper unauth , {}'.format(addr))
        return {'name': 'unauth', 'url': addr, 'software': 'zookeeper'}


async def zookeeper_scan(addr):
    vul_list = []
    a = await check_unauth(addr)
    if a is not None:
        vul_list.append(a)
    return vul_list
